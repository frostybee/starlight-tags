---
import type { ProcessedTag } from '../schemas/tags.js';

interface Props {
  tag: ProcessedTag;
  showLabel?: boolean;
  showSkillLevel?: boolean;
  showEstimatedTime?: boolean;
  size?: 'small' | 'medium' | 'large';
}

const { 
  tag, 
  showLabel = true, 
  showSkillLevel = true, 
  showEstimatedTime = true,
  size = 'medium'
} = Astro.props;

const difficultyConfig = {
  beginner: {
    label: 'Beginner',
    icon: 'üå±',
    color: '#10b981',
    description: 'No prior knowledge required'
  },
  intermediate: {
    label: 'Intermediate', 
    icon: 'üåø',
    color: '#f59e0b',
    description: 'Some background knowledge helpful'
  },
  advanced: {
    label: 'Advanced',
    icon: 'üå≥', 
    color: '#ef4444',
    description: 'Significant background knowledge required'
  }
};

const difficulty = tag.difficulty ? difficultyConfig[tag.difficulty] : null;
const hasAnyIndicator = difficulty || tag.skillLevel || tag.estimatedTime;
---

{hasAnyIndicator && (
  <div class={`difficulty-indicator difficulty-indicator--${size}`}>
    {difficulty && (
      <div class="difficulty-indicator__main">
        <div 
          class="difficulty-indicator__badge"
          style={`--difficulty-color: ${difficulty.color}`}
          title={difficulty.description}
        >
          <span class="difficulty-indicator__icon">{difficulty.icon}</span>
          {showLabel && (
            <span class="difficulty-indicator__label">{difficulty.label}</span>
          )}
        </div>
      </div>
    )}
    
    <div class="difficulty-indicator__details">
      {tag.skillLevel && showSkillLevel && (
        <div class="difficulty-indicator__skill">
          <span class="difficulty-indicator__skill-label">Level:</span>
          <div class="difficulty-indicator__skill-bar">
            {Array.from({ length: 10 }, (_, i) => (
              <div 
                class={`difficulty-indicator__skill-dot ${i < tag.skillLevel ? 'active' : ''}`}
                key={i}
              />
            ))}
          </div>
          <span class="difficulty-indicator__skill-value">{tag.skillLevel}/10</span>
        </div>
      )}
      
      {tag.estimatedTime && showEstimatedTime && (
        <div class="difficulty-indicator__time">
          <span class="difficulty-indicator__time-icon">‚è±Ô∏è</span>
          <span class="difficulty-indicator__time-value">
            {tag.estimatedTime < 60 
              ? `${tag.estimatedTime}min`
              : `${Math.floor(tag.estimatedTime / 60)}h ${tag.estimatedTime % 60}m`
            }
          </span>
        </div>
      )}
      
      {tag.learningObjectives && tag.learningObjectives.length > 0 && (
        <div class="difficulty-indicator__objectives">
          <span class="difficulty-indicator__objectives-label">Focus:</span>
          <div class="difficulty-indicator__objectives-list">
            {tag.learningObjectives.map(objective => (
              <span class="difficulty-indicator__objective" key={objective}>
                {objective === 'conceptual' && 'üí°'}
                {objective === 'practical' && 'üîß'}
                {objective === 'problem-solving' && 'üß©'}
                {objective === 'analytical' && 'üìä'}
                <span class="difficulty-indicator__objective-text">
                  {objective.charAt(0).toUpperCase() + objective.slice(1).replace('-', ' ')}
                </span>
              </span>
            ))}
          </div>
        </div>
      )}
    </div>
  </div>
)}

<style>
  .difficulty-indicator {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.75rem;
    background: var(--sl-color-bg-nav);
    border: 1px solid var(--sl-color-hairline-light);
    border-radius: var(--sl-border-radius);
    margin: 0.5rem 0;
  }
  
  .difficulty-indicator--small {
    padding: 0.5rem;
    gap: 0.375rem;
  }
  
  .difficulty-indicator--large {
    padding: 1rem;
    gap: 0.75rem;
  }
  
  .difficulty-indicator__main {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .difficulty-indicator__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, var(--difficulty-color) 10%, transparent);
    border: 1px solid var(--difficulty-color);
    border-radius: var(--sl-border-radius);
    font-size: var(--sl-text-sm);
    font-weight: 500;
    color: var(--difficulty-color);
  }
  
  .difficulty-indicator--small .difficulty-indicator__badge {
    padding: 0.125rem 0.375rem;
    font-size: var(--sl-text-xs);
  }
  
  .difficulty-indicator--large .difficulty-indicator__badge {
    padding: 0.375rem 0.75rem;
    font-size: var(--sl-text-base);
  }
  
  .difficulty-indicator__icon {
    font-size: 1em;
  }
  
  .difficulty-indicator__label {
    white-space: nowrap;
  }
  
  .difficulty-indicator__details {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .difficulty-indicator--small .difficulty-indicator__details {
    gap: 0.375rem;
  }
  
  .difficulty-indicator__skill,
  .difficulty-indicator__time,
  .difficulty-indicator__objectives {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: var(--sl-text-sm);
  }
  
  .difficulty-indicator--small .difficulty-indicator__skill,
  .difficulty-indicator--small .difficulty-indicator__time,
  .difficulty-indicator--small .difficulty-indicator__objectives {
    font-size: var(--sl-text-xs);
  }
  
  .difficulty-indicator__skill-label,
  .difficulty-indicator__time-icon,
  .difficulty-indicator__objectives-label {
    color: var(--sl-color-text-accent);
    font-weight: 500;
    min-width: fit-content;
  }
  
  .difficulty-indicator__skill-bar {
    display: flex;
    gap: 0.125rem;
  }
  
  .difficulty-indicator__skill-dot {
    width: 0.375rem;
    height: 0.375rem;
    border-radius: 50%;
    background: var(--sl-color-bg-sidebar);
    border: 1px solid var(--sl-color-hairline-shade);
    transition: all 0.2s ease;
  }
  
  .difficulty-indicator--large .difficulty-indicator__skill-dot {
    width: 0.5rem;
    height: 0.5rem;
  }
  
  .difficulty-indicator__skill-dot.active {
    background: var(--sl-color-accent);
    border-color: var(--sl-color-accent);
  }
  
  .difficulty-indicator__skill-value {
    color: var(--sl-color-text-accent);
    font-weight: 500;
    min-width: fit-content;
  }
  
  .difficulty-indicator__time-value {
    color: var(--sl-color-text);
    font-weight: 500;
  }
  
  .difficulty-indicator__objectives-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
  
  .difficulty-indicator__objective {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.375rem;
    background: var(--sl-color-bg);
    border: 1px solid var(--sl-color-hairline-shade);
    border-radius: var(--sl-border-radius);
    font-size: var(--sl-text-xs);
    color: var(--sl-color-text-accent);
  }
  
  .difficulty-indicator__objective-text {
    font-weight: 500;
  }
  
  @media (max-width: 640px) {
    .difficulty-indicator__details {
      flex-direction: column;
    }
    
    .difficulty-indicator__skill,
    .difficulty-indicator__time,
    .difficulty-indicator__objectives {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }
    
    .difficulty-indicator__objectives-list {
      width: 100%;
    }
  }
</style>