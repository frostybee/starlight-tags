---
/**
 * MDX-compatible wrapper for DifficultyIndicator component
 * This component can be imported and used directly in MDX files
 */
import { DifficultyIndicator } from 'starlight-tags/components';
import { TagsProcessor } from 'starlight-tags';
import { config } from 'virtual:starlight-tagging/config';
import type { ProcessedTag } from 'starlight-tags/schemas/tags';

interface Props {
  /** Tag ID to display (fetches from tags.yml) */
  tagId?: string;
  /** Or provide tag data directly */
  tag?: ProcessedTag;
  /** Size variant */
  size?: 'small' | 'medium' | 'large';
  /** Show difficulty label */
  showLabel?: boolean;
  /** Show skill level bar */
  showSkillLevel?: boolean;
  /** Show estimated time */
  showEstimatedTime?: boolean;
}

const {
  tagId,
  tag: providedTag,
  size = 'medium',
  showLabel = true,
  showSkillLevel = true,
  showEstimatedTime = true
} = Astro.props;

// Get tag from processor if tagId is provided
let tag: ProcessedTag | undefined = providedTag;

if (tagId && !tag) {
  const processor = new TagsProcessor(config, console);
  await processor.initialize();
  tag = processor.getTag(tagId);
}
---

{tag ? (
  <DifficultyIndicator
    tag={tag}
    size={size}
    showLabel={showLabel}
    showSkillLevel={showSkillLevel}
    showEstimatedTime={showEstimatedTime}
  />
) : (
  <div class="error-message">
    Tag "{tagId}" not found. Make sure it exists in your tags.yml configuration.
  </div>
)}

<style>
  .error-message {
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, #ef4444 15%, transparent);
    border: 1px solid #ef4444;
    border-radius: var(--sl-border-radius);
    color: #ef4444;
    font-size: var(--sl-text-sm);
  }
</style>
