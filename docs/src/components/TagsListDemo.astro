---
/**
 * MDX-compatible wrapper for TagsList component demos
 */
import { TagsList } from 'starlight-tags/components';
import { initTags, getTag, getAllTagsSorted } from 'virtual:starlight-tagging/tags';
import type { ProcessedTag } from 'starlight-tags/schemas';

interface Props {
  /** Specific tag IDs to display (if not provided, shows all tags) */
  tagIds?: string[];
  /** Optional heading above tags */
  title?: string;
  /** Show page counts on badges */
  showCount?: boolean;
  /** Layout style */
  layout?: 'inline' | 'grid' | 'list';
  /** Badge visual style */
  variant?: 'solid' | 'outline' | 'ghost';
  /** Sort order */
  sortBy?: 'name' | 'count' | 'recent';
  /** Maximum number of tags to show */
  limit?: number;
}

const {
  tagIds,
  title,
  showCount = false,
  layout = 'inline',
  variant = 'solid',
  sortBy = 'name',
  limit
} = Astro.props;

// Initialize tags store (memoized - only runs once across all components)
await initTags();

// Get tags: either specific IDs or all tags
let tags: ProcessedTag[];

if (tagIds && tagIds.length > 0) {
  tags = tagIds
    .map(id => getTag(id))
    .filter((t): t is ProcessedTag => t !== undefined);
} else {
  tags = getAllTagsSorted();
}

// Apply limit if specified
if (limit && limit > 0) {
  tags = tags.slice(0, limit);
}
---

{tags.length > 0 ? (
  <div class="tags-list-demo">
    <TagsList
      tags={tags}
      title={title}
      showCount={showCount}
      layout={layout}
      variant={variant}
      sortBy={sortBy}
    />
  </div>
) : (
  <div class="error-message">
    No tags found. Make sure the tag IDs exist in your tags.yml configuration.
  </div>
)}

<style>
  .tags-list-demo {
    margin: 1rem 0;
  }

  .error-message {
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, #ef4444 15%, transparent);
    border: 1px solid #ef4444;
    border-radius: var(--sl-border-radius);
    color: #ef4444;
    font-size: var(--sl-text-sm);
  }
</style>
